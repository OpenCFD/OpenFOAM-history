#!/bin/sh

# Get application name from directory
application=`basename $PWD`

# Find and source additional functions
tutorialPath=$PWD
while [ ! -f $tutorialPath/RunFunctions ]
do
    tutorialPath="$tutorialPath/.."
done
. $tutorialPath/RunFunctions



setDecompressionTankFine ()
{
    blockMeshDict="$case/constant/polyMesh/blockMeshDict"
    controlDict="$case/system/controlDict"        
    sed \
    -e s/"30 20"/"120 80"/g \
    -e s/"30 5"/"120 20"/g \
    -e s/"25 5"/"100 20"/g \
    -e s/"30 95"/"120 380"/g \
    $blockMeshDict > temp.$$
    mv temp.$$ $blockMeshDict
    sed \
    -e s/"\(deltaT[ \t]*\) 5e-07;"/"\1 1e-07;"/g \
    -e s/"\(endTime[ \t]*\) 0.00025;"/"\1 0.00015;"/g \
    $controlDict > temp.$$
    mv temp.$$ $controlDict    
}

# Do decompressionTank
(cd decompressionTank && $tutorialPath/runAll)

# Clone case
cloneCase decompressionTank decompressionTankFine

cd decompressionTankFine
    # Modify case
    setDecompressionTankFine
    # And execute
    runApplication blockMesh
    runApplication $application
cd ..
