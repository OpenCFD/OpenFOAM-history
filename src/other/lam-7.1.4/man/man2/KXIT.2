.TH KEXIT 2 "July, 2007" "LAM 7.1.4" "LAM LOCAL LIBRARY"
.SH NAME
kexit, _kexit, atkexit \- Terminate LAM process.
.SH C SYNOPSIS
int kexit (int errcode);
.br
int _kexit (int errcode);
.br
int atkexit (int (*func)(), char *arg);
.SH FORTRAN SYNOPSIS
subroutine KXIT (errcode)
.br
integer errcode
.SH DESCRIPTION
A LAM process that calls kenter(2) must call
.I kexit()
to terminate.
.I kexit()
calls all registered LAM exit functions before informing
the local daemon of its death.
.PP
.I _kexit()
may be used instead of
.I kexit()
to avoid calling the exit functions.
.PP
The argument to
.I kexit()
and
.I _kexit()
is an exit code which is sent in a message to the parent process, if requested
by the parent process when the process was created.
See rploadgo(2) and rpwait(2).
By convention the exit code is 0 if the process successfully completed.
.PP
An exit function is registered by calling
.IR atkexit() .
The arguments passed to
.I atkexit()
are the address of the exit function to be called upon
.IR kexit() ,
and an argument to pass to the exit function when it is called.
(Note that the function may ignore the argument, reverting to the
ANSI standard C library atexit(3) behavior, where no argument is passable.)
There is a limit on how many exit functions may be registered.
Exit functions are called in reverse order of their registration.
Some system modules register their own cleanup functions.
.PP
.I kexit()
eventually calls kdetach(2) to gracefully detach from the LAM
daemon and exit(3) to actually terminate within the host operating system.
.SH RETURN VALUE
.I kexit()
and
.I _kexit()
do not return.
Upon successful completion,
.I atkexit()
returns 0.
Otherwise, \-1 is returned and the global variable
.I errno
is set to indicate the error.
.SH ERRORS
.TP 20
ENOEXDESCRIPTORS
There is no room left in the internal table of exit functions.
.SH BUGS
If too many user functions are registered with
.I atkexit()
before calling system functions that also call
.IR atkexit() ,
the latter calls to
.I atkexit()
may fail and some system functions may not be registered.
If the missing exit function is for LAM stream file I/O, some output
data may be lost.
.SH SEE ALSO
kdetach(2), kenter(2)
